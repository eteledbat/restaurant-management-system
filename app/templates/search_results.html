{% extends 'base.html' %}

{% block title %}搜索结果 - 餐饮信息管理系统{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>搜索结果</h2>
    <small class="text-muted">关键词: "{{ query }}"</small>
</div>

<!-- 搜索栏 -->
<div class="row justify-content-center mb-4">
    <div class="col-md-8">
        <form action="{{ url_for('main.search') }}" method="GET" class="d-flex">
            <div class="input-group">
                <input type="text" class="form-control" name="q" value="{{ query }}" placeholder="搜索餐厅或菜品..." required>
                <select class="form-select" name="type" style="max-width: 120px;">
                    <option value="all" {% if search_type == 'all' %}selected{% endif %}>全部</option>
                    <option value="restaurant" {% if search_type == 'restaurant' %}selected{% endif %}>餐厅</option>
                    <option value="dish" {% if search_type == 'dish' %}selected{% endif %}>菜品</option>
                </select>
                <button class="btn btn-primary" type="submit">搜索</button>
            </div>
        </form>
    </div>
</div>

<!-- 餐厅搜索结果 -->
{% if restaurants %}
<div class="mb-5">
    <h4>餐厅结果 ({{ restaurants|length }})</h4>
    <div class="row">
        {% for restaurant in restaurants %}
        <div class="col-md-4 mb-3">
            <div class="card h-100">
                {% if restaurant.img_url %}
                <img src="{{ restaurant.img_url }}" class="card-img-top" alt="{{ restaurant.name }}" style="height: 150px; object-fit: cover;">
                {% else %}
                <img src="{{ url_for('static', filename='images/1.jpg') }}" class="card-img-top" alt="餐厅默认图片" style="height: 150px; object-fit: cover;">
                {% endif %}
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title">{{ restaurant.name }}</h6>
                    <p class="card-text flex-grow-1">
                        <small class="text-muted">{{ restaurant.type }}</small><br>
                        <strong>评分:</strong> 
                        {% if restaurant.rating %}
                            {{ "%.1f"|format(restaurant.rating) }} 
                            <small>({{ restaurant.review_count }} 条评论)</small>
                        {% else %}
                            暂无评分
                        {% endif %}<br>
                        <small>{{ restaurant.address }}</small>
                    </p>
                    <a href="{{ url_for('restaurant.detail', rest_id=restaurant.rest_id) }}" class="btn btn-sm btn-primary mt-auto">查看详情</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- 菜品搜索结果 -->
{% if dishes %}
<div class="mb-5">
    <h4>菜品结果 ({{ dishes|length }})</h4>
    <div class="row">
        {% for dish in dishes %}
        <div class="col-md-3 mb-3">
            <div class="card h-100">
                {% if dish.img_url %}
                <img src="{{ dish.img_url }}" class="card-img-top" alt="{{ dish.name }}" style="height: 120px; object-fit: cover;">
                {% else %}
                <img src="{{ url_for('static', filename='images/2.jpg') }}" class="card-img-top" alt="菜品默认图片" style="height: 120px; object-fit: cover;">
                {% endif %}
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title">{{ dish.name }}</h6>
                    <p class="card-text flex-grow-1">
                        <strong>¥{{ "%.2f"|format(dish.price) }}</strong><br>
                        <small class="text-muted">{{ dish.restaurant_name }}</small><br>
                        {% if dish.description %}
                            <small>{{ dish.description[:30] }}{% if dish.description|length > 30 %}...{% endif %}</small><br>
                        {% endif %}
                        <small class="text-success">推荐数: {{ dish.rec_count }}</small>
                    </p>
                    <a href="{{ url_for('restaurant.detail', rest_id=dish.rest_id) }}" class="btn btn-sm btn-outline-primary mt-auto">查看餐厅</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if not restaurants and not dishes %}
<div class="text-center">
    <div class="alert alert-info">
        <h5>没有找到相关结果</h5>
        <p>尝试使用不同的关键词或搜索类型</p>
    </div>
    <a href="{{ url_for('main.index') }}" class="btn btn-primary">返回首页</a>
</div>
{% endif %}

{% if restaurants or dishes %}
<div class="text-center mt-4">
    <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">返回首页</a>
    <a href="{{ url_for('restaurant.restaurant_list') }}" class="btn btn-outline-primary">浏览所有餐厅</a>
</div>
{% endif %}
{% endblock %}